# 2025/6/3

## AvifとWebPの充実

ひとまず、オリジナルから変換するだけの構造を追加。

それぞれの因子に対するバリエーションを拡充していく。

# WebPの因子

WebPフォーマットの相互変換テストで着目すべき主要な因子を整理します：

## 画像データ関連

- **色空間**: sRGB、Adobe RGB、P3、Rec.709、グレースケール
- **ビット深度**: 8bit、10bit、12bit、16bit（WebPは8bitまでだが変換時の処理が重要）
- **アルファチャンネル**: 透明度情報の保持、プリマルチプライド/ストレート
- **アニメーション**: フレーム数、フレームレート、ループ回数、フレーム間圧縮

## 圧縮・エンコーディング関連

- **圧縮品質設定**: 0-100のクオリティパラメータ
- **エンコーディング手法**: VP8（非可逆）、VP8L（可逆）、VP8X（拡張）
- **チャンクサイズ**: 分割エンコーディングのブロックサイズ
- **プログレッシブ/ベースライン**: 段階的表示の有無

## メタデータ関連（既に挙げられたものに加えて）

- **カラープロファイル埋め込み**: ICCプロファイルのバージョンと互換性
- **画像の向き**: Exif Orientationタグの処理
- **GPS情報**: 位置情報の保持
- **著作権情報**: コピーライト、作者情報
- **カメラ設定**: ISO、シャッタースピード、絞り値など

## フォーマット固有の要素

- **WebP特有のメタデータ**: XMP、EXIF、ICCPチャンク
- **JPEG固有**: DCTブロック、サブサンプリング（4:4:4、4:2:2、4:2:0）
- **PNG固有**: インターレース、フィルタータイプ、圧縮レベル
- **TIFF固有**: マルチページ、圧縮方式（LZW、ZIP等）

## パフォーマンス・互換性

- **ファイルサイズ**: 圧縮効率の比較
- **エンコード/デコード速度**: 処理時間
- **メモリ使用量**: 変換時のメモリ消費
- **ブラウザ/アプリ互換性**: 各環境での表示確認

これらの因子を組み合わせてテストケースを設計することで、包括的な相互変換の検証が可能になります。

# AVIFの因子

AVIFフォーマット特有の変換テストで着目すべき因子を整理します：

## AVIF固有のコーデック関連

- **エンコーダ**: libaom、rav1e、SVT-AV1の違い
- **プロファイル**: Main、High、Professional
- **レベル**: 5.1、6.0など（解像度・ビットレート制限）
- **タイル設定**: タイルの行数・列数、独立タイル処理
- **スレッド数**: 並列処理の設定

## 色深度・色空間

- **ビット深度**: 8bit、10bit、12bit（AVIFは12bitまでネイティブ対応）
- **色空間**: YUV420、YUV422、YUV444、モノクロ
- **HDR対応**: HDR10、HLG、PQ転送関数
- **広色域**: BT.2020、Display P3のサポート
- **CICP（Coding-Independent Code Points）**: 色空間の明示的指定

## 圧縮パラメータ

- **CRF（Constant Rate Factor）**: 0-63の品質設定
- **量子化パラメータ**: minQuantizer、maxQuantizer
- **スピードプリセット**: 0-10（速度vs品質のトレードオフ）
- **適応的量子化**: デルタQ、デルタLF
- **フィルムグレイン合成**: ノイズ保持の設定

## AVIF特有の機能

- **レイヤード画像**: プログレッシブデコーディング対応
- **グリッド画像**: 大画像の分割エンコーディング
- **アルファチャンネル**: 別ストリームでのエンコード
- **深度マップ**: 3D情報の保持
- **ゲインマップ**: HDR/SDR互換性のための情報

## アニメーション（AVIF sequence）

- **キーフレーム間隔**: イントラフレームの頻度
- **時間的レイヤー**: スケーラブルな時間解像度
- **ループ設定**: 無限ループ、回数指定

## メタデータとコンテナ

- **HEIF/MIAF準拠**: ISOBMFFコンテナフォーマット
- **Exif/XMP**: 従来のメタデータ形式のサポート
- **PIXI**: ピクセル情報の明示的記述
- **カラープロファイル**: nclx、rICC、prof
- **変換メタデータ**: 回転、ミラーリング、クロップ

## 互換性・制限事項

- **最大解像度**: エンコーダごとの制限
- **クロマサブサンプリング**: 4:2:0制限のあるデコーダ
- **モノクロ画像**: 専用の効率的なエンコーディング
- **プログレッシブデコード**: 対応デコーダの確認

これらのAVIF特有の因子は、特にHDR対応や高ビット深度、効率的な圧縮アルゴリズムなど、従来のフォーマットにない先進的な機能のテストが重要になります。
